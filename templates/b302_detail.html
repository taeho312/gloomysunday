{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width: 1000px; margin: 60px auto 100px auto; padding: 0 20px;">
    <div style="margin-bottom: 25px;">
        <a href="{{ url_for('d_velo') }}" style="color: #e0861f; text-decoration: none; font-size: 0.9rem; letter-spacing: 1px;">← 돌아가기</a>
    </div>
    
    <div class="rumor-card" style="background: rgba(10, 26, 18, 0.8); border: 1px solid rgba(224, 134, 31, 0.4); padding: 50px; backdrop-filter: blur(12px);">
        <div style="display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 1px solid rgba(224, 134, 31, 0.2); padding-bottom: 20px; margin-bottom: 40px;">
            <div>
                <h2 style="color: #e0861f; font-family: 'Hahmlet', serif; font-size: 2.2rem; margin: 0;">D'VELO 302</h2>
                <p style="color: #666; font-family: 'Hahmlet', serif; font-size: 0.85rem; margin-top: 5px;">호수를 클릭하면 입주민 정보를 확인할 수 있습니다.</p>
            </div>
            <div style="text-align: right; color: #efefef; font-family: 'Gothic A1', sans-serif; font-size: 0.9rem;">
                대한민국 서울특별시 서초구 문하동 183-8
            </div>
        </div>

        <div class="matrix-container">
            <table class="unit-table">
                <tbody id="unitTableBody">
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="unitModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle" style="color: #e0861f; margin: 0; font-family: 'Hahmlet', serif;"></h3>
            <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="modalGallery" class="unit-gallery">
            </div>
            
            <div class="unit-specs">
                <p id="specNo"></p>
                <p id="specResident"></p>
                <p id="specFeature"></p>
                <p id="specStatus" style="color: #e0861f; font-weight: bold;"></p>
            </div>
        </div>
    </div>
</div>

<style>
    /* 기존 단지 배치도 스타일 유지 */
    .matrix-container { background: #050505; border: 1px solid #333; padding: 40px; position: relative; overflow: hidden; }
    .unit-table { width: 100%; max-width: 450px; margin: 0 auto; border-collapse: separate; border-spacing: 10px; position: relative; z-index: 1; }
    .unit-cell { background: rgba(255, 255, 255, 0.01); border: 1px solid rgba(255, 255, 255, 0.05); color: #333; padding: 15px; text-align: center; font-family: 'Gothic A1', sans-serif; cursor: default; transition: 0.3s; }
    .unit-cell.active { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); color: #fff; cursor: pointer; }
    .unit-cell.active:hover { background: rgba(224, 134, 31, 0.15); border-color: #e0861f; color: #e0861f; transform: translateY(-3px); }
    .penthouse.active { background: rgba(224, 134, 31, 0.05); border: 1px solid rgba(224, 134, 31, 0.5); color: #e0861f; }

    /* 갤러리: 한 줄(1열) 가로 배치 고정 */
    .unit-gallery {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        gap: 10px;
        margin-bottom: 25px;
        background: #000;
        border: 1px solid #222;
        padding: 10px;
        height: 250px;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    .unit-gallery img {
        flex: 1;
        min-width: 0;
        height: 100%;
        object-fit: cover;
        border: 1px solid rgba(224, 134, 31, 0.2);
        transition: 0.3s;
        cursor: zoom-in;
    }
    .unit-gallery img:hover { border-color: #e0861f; transform: scale(1.02); z-index: 2; }
    .unit-gallery:empty::before { content: 'NO ARCHIVE IMAGE'; color: #444; font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

    /* 모달 레이아웃 수정: 상단 고정 및 내부 스크롤 */
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.92); backdrop-filter: blur(10px); z-index: 3000; align-items: center; justify-content: center; }
    
    .modal-content { 
        width: 95%; 
        max-width: 700px; 
        max-height: 85vh; /* 화면 높이의 85%로 제한 */
        background: rgba(10, 26, 18, 0.98); 
        border: 1px solid rgba(224, 134, 31, 0.6); 
        display: flex;
        flex-direction: column; /* 헤더와 본문을 세로로 배치 */
        padding: 0; /* 내부 여백은 헤더와 본문에서 따로 처리 */
        font-family: 'Nanum Myeongjo', serif !important;
        overflow: hidden;
    }

    .modal-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        border-bottom: 1px solid rgba(224, 134, 31, 0.2); 
        padding: 25px 40px; /* 헤더 여백 고정 */
        background: rgba(10, 26, 18, 1);
        z-index: 10;
    }

    .modal-body {
        padding: 20px 40px 40px 40px;
        overflow-y: auto; /* 내용이 넘칠 때 본문만 스크롤 */
        flex: 1;
    }

    .close-btn { color: #888; font-size: 35px; cursor: pointer; line-height: 1; }
    .close-btn:hover { color: #e0861f; }

    .unit-specs { color: #efefef; font-size: 0.95rem; line-height: 2.2; font-family: 'Nanum Myeongjo', serif !important; }
    .unit-specs p { margin: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
    .unit-specs b { color: #fff; font-weight: 700; }

    /* 스크롤바 디자인 */
    .modal-body::-webkit-scrollbar { width: 6px; }
    .modal-body::-webkit-scrollbar-track { background: #050505; }
    .modal-body::-webkit-scrollbar-thumb { background-color: #e0861f; border-radius: 10px; }
    .modal-body { scrollbar-width: thin; scrollbar-color: #e0861f #050505; }

    /* 이미지 전체보기 모달 스타일 */
    .full-modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 5000; cursor: zoom-out; align-items: center; justify-content: center; }
    .full-modal-content { max-width: 95%; max-height: 95%; object-fit: contain; animation: zoomIn 0.3s ease; }
    .full-modal-close { position: absolute; top: 20px; right: 40px; color: #fff; font-size: 50px; font-weight: bold; cursor: pointer; }
    @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
</style>

<script>
    const unitData = {
        "1101": { 
            resident: "태희주", 
            feature: "나도 많이 노력했어요. 압니까? 열심히 공부하고, 돈도 좀 가져다 바치고⋯⋯. 물론 집안의 힘이 90%긴 하지만 그게 중요한가? 세상은 원래 불공평한 것을. 그저 방탕하게만 살기에는 내가 욕심이 너무 많아서 안 되겠더라고. 신이 내게 욕망과 그걸 이룰 힘을 주셨으니 감사히 여기고는 있습니다. Grazie, Signore!", 
            status: "입주 완료", 
            images: ["/static/img/302_1101_plan.gif"] 
        },
        "1001": { 
            resident: "태희재", 
            feature: "매일같이 피아노 곁을 지키던 일상을 클럽에 빠져 술과 색으로 채웠다. 사춘기가 늦게 와 버렸다는 가족들의 걱정에도 매일 같이 가벼운 것들을 쫓아다니기에 바빴다. 방종 속에서 새로운 목표를 찾게 될지는 본인도 몰랐을 것이다.", 
            status: "입주 완료", 
            images: ["/static/img/302_1001_plan.gif"] 
        },
        "902": { 
            resident: "차상우", 
            feature: "한 시대를 대표하던 농구 스타. 선수 시절에는 NBA 진출 제의가 거론될 만큼 국내 리그를 평정했고, 팀을 여러 차례 우승으로 이끈 간판 선수였으나 반복된 무릎 부상 끝에 전성기에 은퇴했다. 선수 활동 당시 억대 연봉도 받았고, 자산가 집안의 딸인 어머니와 이름난 외과 의사인 아버지 사이에서 태어나 탄탄한 재력 속에서 자랐기에 은퇴 이후에도 삶의 기반이 흔들릴 일은 없었다. 현재는 외가 자본으로 설립된 스포츠 재단의 이사장이자 산하 농구 아카데미 대표로, 유소년 인재 발굴과 엘리트 선수 육성을 총괄하고 있다.", 
            status: "입주 완료", 
            images: ["/static/img/302_902_plan.gif"] 
        },
        "801": { 
            resident: "채유인", 
            feature: "채유인, 서른 다섯. 본명 최유인. 부드러운 호명과 특색을 위해 성을 바꿔 활동 중인 13년차 배우. 스크린, 티비, 광고. 요근래 그 어디를 봐도 가장 쉽게 볼 수 있는 얼굴은 단언컨대 그녀일 것이다. 작품이야 수도 없이 찍었다. 정작 반응이 오기 시작한 것은 5년도 채 되지 않았을 뿐. 주연을 맡은 드라마가 큰 반응을 불러오며 점차 입지가 넓어졌고, 현재로서는 모든 분야의 러브콜 순위에 굳건히 자리를 잡았다. 배우란 자고로, 어디서든 연기를 게을리 하지 않아야 하는 법이다.", 
            status: "입주 완료", 
            images: ["/static/img/302_801_plan.gif"] 
        },
        "102": { 
            resident: "이욱", 
            feature: "가장 많이 그리는 건 호랑이와 해골. 뱀과 늑대. 불꽃, 혹은 파도. 재패니즈에 뉴스쿨을 뒤섞은 강렬한 스타일로 이름을 알려, 국내 뿐만 아니라 아시아부터 유럽까지 온갖 국가에서도 초빙을 받아 시술을 하는 타투이스트 인플루언서. 징그럽다. 과하다. 예, 뭐. 좆까시고. 허옇게 말라붙기만 한 몸만큼 심심한 게 어디 있는지. 내가 남겨주는 것보다 네가 예뻐질 방법은 없을걸.", 
            status: "입주 완료", 
            images: ["/static/img/302_102_plan.gif"] 
        },
        "101": { 
            resident: "주지명", 
            feature: "서울특별시 강남구 소재의 U 호텔의 이사. 정장 차림은 매일같이 변하고, 뒷머리 있는 긴 기장의 헤어 스타일을 몇 년째 고수 중. 본래 직업은 사채업자지만, 더러운 돈을 깨끗하게 세탁하기 위해 호텔을 인수했다. 누군가에게는 이사님, 또 다른 누구는 형님이라고 부르기에. 돈이면 세상 모든 것을 다 살 수 있다고 믿는 어리석은 남성.", 
            status: "입주 완료", 
            images: ["/static/img/302_101_plan.gif"] 
        }
    };

    // 표 생성 로직 (기존과 동일)
    const tableBody = document.getElementById('unitTableBody');
    let tableHtml = '';
    const p1101 = "1101";
    const isActive1101 = unitData[p1101] ? "active" : "";
    tableHtml += `<tr><td colspan="2" class="unit-cell penthouse ${isActive1101}" onclick="openModal('${p1101}')">1101</td></tr>`;
    for (let f = 10; f >= 1; f--) {
        const u1 = (f * 100 + 1).toString();
        const u2 = (f * 100 + 2).toString();
        const active1 = unitData[u1] ? "active" : "";
        const active2 = unitData[u2] ? "active" : "";
        tableHtml += `<tr><td class="unit-cell ${active1}" onclick="openModal('${u1}')">${u1}</td><td class="unit-cell ${active2}" onclick="openModal('${u2}')">${u2}</td></tr>`;
    }
    tableBody.innerHTML = tableHtml;

    function openModal(unitNo) {
        const data = unitData[unitNo];
        if (!data) return;

        document.getElementById('modalTitle').innerText = "UNIT ARCHIVE: " + unitNo;
        document.getElementById('specNo').innerText = "■ 호수: " + unitNo + "호";
        document.getElementById('specResident').innerText = "■ 입주민: " + data.resident;
        document.getElementById('specFeature').innerHTML = "■ 특징: " + data.feature;
        document.getElementById('specStatus').innerText = "■ 상태: " + data.status;

        const gallery = document.getElementById('modalGallery');
        gallery.innerHTML = ''; 

        if (data.images && data.images.length > 0) {
            data.images.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                gallery.appendChild(img);
            });
        }
        document.getElementById('unitModal').style.display = 'flex';
    }

    function closeModal() { document.getElementById('unitModal').style.display = 'none'; }
    window.onclick = function(e) { if (e.target == document.getElementById('unitModal')) closeModal(); }
</script>
{% endblock %}